---
title: "Компьютерная домашняя работа 1"
author: "Копчев Владислав, ПСА-1, 198-2"
date: "13.04.2021"
output:
  html_document:
    df_print: paged
  pdf_document:
    df_print: paged
lang: ru-russian
---

Загрузка пакетов:
```{r}
#install.packages("ggm")
library(ggm)
library(ggpubr)
library(ppcor)
library(factoextra)
```

1. Данные позволяют сравнить 80 государств между собой по следующим показателям:
state: название государства
area: площадь территории государства
population: население государства
GDP: ВВП по ППС на дущу населения в долларах
publications_count: общее количество научно-исследовательских статей, опубликованных в рецензируемых научных изданиях, включённых в систему индекса научного цитирования
primary_ed_idx: индекс качества начального образования  по версии ВЭФ
education_spending: общий объём государственных и частных расходов на образование, выраженный в процентах от ВВП
avg_salary: срелняя заработная плата в долларах
Все показатели берутся за фиксированный 2018 год, и поэтому данные являются пространственными.

Импорт данных и визуализация данных в виде таблицы:
```{r}
data <- read.csv("data.csv", head = TRUE, sep = ";")
data
```
Проведу корреляционный анализ.

Диаграмма рассеяния для количества публикаций и ВВП:
```{r}
ggscatter(data, x = "publications_count", y = "GDP", 
          xlab = "Количество публикаций", ylab = "ВВП, долларов")
```

Имеется 1 нетипичное наблюдение:
```{r}
data_new <- data[-which(data$publications_count %in% sort(data$publications_count)[(nrow(data)+0):nrow(data)]),]
```

После удаления
```{r}
ggscatter(data_new, x = "publications_count", y = "GDP", 
          xlab = "Количество публикаций", ylab = "ВВП, долларов")
```

Построю диаграмму рассеяния для средней зарплаты и расходов на образование:
```{r}
ggscatter(data, x = "avg_salary", y = "education_spending", 
          xlab = "Средняя зарплата, долларов", ylab = "Расходы на образование")
```

Имеется 1 нетипичное наблюдение, удалю его.
```{r}
data_new <- data_new[-which(data$avg_salary %in% sort(data$avg_salary)[(nrow(data)+0):nrow(data)]),]
```

После удаления:
```{r}
ggscatter(data_new, x = "GDP", y = "avg_salary", 
          xlab = "ВВП, долларов", ylab = "Средняя зарплата, долларов")
```
Видно, что корреляция близка к единице: точки выстроены будто бы вдоль прямой.

Посчитаю коэффициент корреляции между ВВП и средней зарплатой до удаления и после:
```{r}
print("after del:")
cor(data_new["GDP"], data_new["avg_salary"], method = "pearson")
print("before del:")
cor(data["GDP"], data["avg_salary"], method = "pearson")
```

Действительно, коэффициент корреляции оказался близок к единице, притом после удаления выбросов он увеличился, что было ожидаемо. 

Построю теперь корреляционную матрицу до и после удаления выбросов:
```{r}
print("before del:")
cor(data[2:8])
print("after del:")
cor(data_new[2:8])
```
Мы видим, что высока связь между переменными publications_count и population, GDP и primary_ed_idx, GDP и avg_salary, primary_ed_idx и avg_salary. Таким образом, есть прямая корреляция между количеством публикаций и населением, а также между ВВП и уровнем начального образования и средней зарплатой. Это можно объяснить следующим образом: чем больше население, тем больше людей идут в науку, тем больше они пишут статей. При этом чем выше ВВП, тем богаче страна, и тем больше денег можно выделить на начальное образование, и тем больше будут зарплаты. Притом чем лучше начальное образование, тем умнее люди, и тем больше они зарабатывают.
По значениям коэффиицента корреляции у GDP и primary_ed_idx и GDP и avg_salary мы видим, что в данных есть мультиколлинеарность.

Замечу, что в силу того, что у указанных выше трех пар переменных высокий коэффициент корреляции, а state не является непрерывной переменной. Тогда оставлю переменные publications_count, primary_ed_idx, area, education_spending, чтобы исследовать связь различных показателей сферы науки и образовани (публикации, траты на образование, уровень развития начального образования) с площадью страны так, чтобы выбранные перемнные не слишком сильно коррелировали между собой. Проверю, что коэффициенты коррелчции действительно невысокие.
```{r}
data_cont = data_new[,c("publications_count", "primary_ed_idx", "area", "education_spending")]
data_cont
cor(data_cont)
```
Действительно, данные отобраны в соответствии с помтавленными целями.

Стандартизую и нормализую данные:
```{r}
cluster_data <- scale(data_cont, center=TRUE, scale = TRUE)
cluster_data
```

3. Приступлю к иерархической кластеризации. Для начала выберу евклидову метрику, поскольку логично, что если показатель, связанный с наукой и образованием, у двух стран такой, что их разность меньше единицы, то, скорее всего, разница в этом показателе почти незначительна, и возведение получившейся разницы в квдрат сделает ее еще меньше единицы и сблизит страны друг с другом по этому показатлю еще сильнее. При этом, если он разный, то разница, скорее всего, сильная, и ее надо усилить, возведя разницу, большуюю единицы, в квадрат. Таким образом, выберупринцип Варда с евклидовой метрикой:
```{r}
hclust <- hcut(cluster_data, k = 2, hc_metric = 'euclidian', hc_method = 'ward.D2')
```

Изображу результаты кластеризации на дендограмме и выберу по ней оптимальное их число:
```{r}
fviz_dend(hclust, cex = 0.3, color_labels_by_k = TRUE, main = 'Дендрограмма (принцип Варда)', ylab = 'Расстояние')
plot(hclust, cex = 0.6, main = "9 кластеров")
rect.hclust(hclust, k = 9, border="red")
```

По дендограмме можно сделать вывод, что 9 — оптимальное число кластеров.

4. Приступлю к методу k-средних.
Воспользуюсь elbow method для выбора числа кластеров (аналогично, для начала необходимо удалить некоторые столбцы).
```{r}
fviz_nbclust(cluster_data, kmeans, method = 'wss') +
  labs(x = 'число кластеров', y = 'сумма внутрикластерных дисперсий',
       title = 'Зависимость WSS от числа кластеров')
```

Изгиб (убывание замедления WSS) заметен после точек 2, 4 и 9. Выберу оптимальное число кластеров с помощью silhouette method.
```{r}
fviz_nbclust(cluster_data, kmeans, method = "silhouette") +
  labs(subtitle = "Silhouette method")
```

Получается, оптимальное число кластеров = 5. С помощью дендограммы же получилосьчисло 9. Осуществлю кластеризацию для двух этих значений $k$ и визуализирую результат (метрика снова евклидова, выбор уже был обоснован раннее):
```{r}
kmeans1 <- kmeans(cluster_data, centers = 5)
kmeans2 <- kmeans(cluster_data, centers = 9)
fviz_cluster(kmeans1, cluster_data, frame = FALSE, geom = "point")
fviz_cluster(kmeans2, cluster_data, frame = FALSE, geom = "point")
```
Как видно, на первом графике (при $k$ = 5) данные распределены более равномерно. Поэтому наиболее подходящий вариант равен 5.

Как видно по графику, фиолетовый кластер находится левее значения -1 по оси х, все остальные находятся правее и различаются относительно оси у.

Вывод: я выяснил, что между переменными publications_count и population, GDP и primary_ed_idx, GDP и avg_salary, primary_ed_idx и avg_salary существует высокая прямая корреляция, и что оптимальное число кластеров = 5.